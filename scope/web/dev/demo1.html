<html>

<head>
    <title>Genome Browser</title>
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/style0/lib.css">
    <script type="text/javascript" src="/lib/d3.v4.min.js"></script>
    <script type="text/javascript" src="/lib/d3-queue.v2.min.js"></script>
    <script type="text/javascript" src="/lib/d3-request.v1.min.js"></script>
    <script type="text/javascript" src="/lib/jquery.min.js"></script>
    <script type="text/javascript" src="/lib/bootstrap.min.js"></script>

    <script type="text/javascript" src="/lib0/brush.js"></script>
    <script type="text/javascript" src="/lib0/axis.js"></script>
    <script type="text/javascript" src="/lib0/axes.js"></script>

    <script type="text/javascript" src="/lib0/lib.js"></script>
    <script type="text/javascript" src="/lib0/bigwig.js"></script>
    <script type="text/javascript" src="/lib0/hic2.js"></script>

</head>

<body>

    <div id="top" class="menu">
        <label for="width"> width </label> <span id="width"></span>
        <label for="height"> height </label> <span id="height"></span>
    </div>
    <div id="left" class="container">
    </div>
    <div id="main" class="container">
        <canvas width=1000 height=800 style="postion:absolute;left:0px;top:0px">
        </canvas>
        <svg width=1000 height=800 style="position:absolute;left:0px;top:0px">
        </svg>

    </div>
</body>
<script>
    (function(S) {
        var H = S.dataHic
        var svg = d3.select("svg")
        var canvas = d3.select("canvas")
        var panel = d3.select("#main")
        var B = S.dataBigwig;
        var regions = [{
            "chr": "chr1",
            "start": 1,
            "end": 10000000
        }, {
            "chr": "chr2",
            "start": 10000000,
            "end": 30000000
        }]
        var background = "#FFE"
        var ctx = canvas.node().getContext("2d");
        var render = function(regions) {
            svg.selectAll("*").remove(); //TODO
            ctx.fillStyle = background
            ctx.fillRect(0, 0, 1000, 800)

            svg.call(S.axes().regions(regions).on("submit", function(d) {
                render(d)
            }).on("brush", function(d) {
                console.log("resp", d)
                bw.response(d)
            }))
            var bw = B.canvas()
                .URI("/bw")
                .id("chipseq") //TODO
                .x(0)
                .y(450)
                .width(800)
                .gap(20) //TODO REMV
                .regions(regions)
                .panel(panel)
                .pos(1) //for response id
            var chart = H.canvas()
                .URI("/hic")
                .norm(hic.norm)
                .unit(hic.unit)
                .bpres(
                    [
                        2500000,
                        1000000,
                        500000,
                        250000,
                        100000,
                        50000,
                        25000,
                        10000,
                        5000
                    ]
                )
                .xoffset(0)
                .yoffset(400)
                .width(edge)
                .height(edge)
                .regions(trimChr(regions))
                .panel(panel)
                .color1(hic.color1)
                .color2(hic.color2)
                .rotate(0) //OR NOT.
                .gap(20)
            canvas.call(bw)
            canvas.call(chart)
        }
        var hic = {
            "norm": 0,
            "unit": 0,
            "bpres": 0,
            "color1": "#FFF",
            "color2": "#F00"
        }
        var edge = 800
        var trimChr = function(regions) {
            var a = []
            regions.forEach(function(d) {
                a.push({
                    "chr": d.chr.replace("chr", ""),
                    "start": d.start,
                    "end": d.end
                })
            })
            return a
        }

        //.svg(svgdiv)
        //.panel(panel)
        //.emit(setRegions)
        //.callback(showPara)
        render(regions)




    }(snow))
</script>

</html>
</script>

</html>
