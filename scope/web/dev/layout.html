<html>

<head>
    <title>GoldenLayout Demo</title>
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/goldenlayout-base.css">
    <link rel="stylesheet" href="/css/goldenlayout-light-theme.css">
    <script type="text/javascript" src="/lib/jquery.min.js"></script>
    <script type="text/javascript" src="/lib/d3.v4.min.js"></script>
    <script type="text/javascript" src="/lib/goldenlayout.min.js"></script>
</head>

<body>
</body>
<script>
    (function($) {
        var config = {
            content: [{
                type: 'row',
                content: [{
                        type: "column",
                        content: [

                            {
                                type: 'component',
                                componentName: 'ctrl',
                                componentState: {
                                    text: 'TODO CTRL'
                                }
                            },
                            {
                                type: 'component',
                                componentName: 'monitor',
                                componentState: {
                                    text: 'TODO 3D'
                                }
                            }
                        ]
                    },
                    {
                        type: 'component',
                        componentName: 'canvas',
                        componentState: {
                            title: 'Canvas 3',
                        }
                    }
                ]
            }]
        };
        var states = {

        }
        //var dispatch = d3.dispatch("resize")
        var myLayout,
            savedState = localStorage.getItem('snowScopeState');
        if (savedState !== null) {
            myLayout = new GoldenLayout(JSON.parse(savedState));
        } else {
            myLayout = new GoldenLayout(config);
        }
        myLayout.on('stateChanged', function() {
            var state = JSON.stringify(myLayout.toConfig());
            localStorage.setItem('snowScopeState', state);
        });
        myLayout.registerComponent('ctrl', function(container, state) {
            container.getElement().html('<h2>' + state.text + '</h2>');
            container.on("resize", function(e) {
                console.log("resize", e)
                //dispatch.call("resize", this, {})
                myLayout.eventHub.emit("resize", "ab")
            })
            var input = $('<input type="text" />');
            if (state.regionTxt) {
                input.val(state.regionTxt); //for now.
            }
            input.on('change', function() {
                container.extendState({
                    regionTxt: input.val()
                });
            });

            container.getElement().append(input);

        });
        myLayout.registerComponent('monitor', function(container, state) {
            container.getElement().html('<h2>' + state.text + '</h2>');
            container.on("resize", function(e) {
                console.log("resize", e)
                //dispatch.call("resize", this, {})
                myLayout.eventHub.emit("resize", "ab")
            })
            d3.select(container.getElement()[0]).append("canvas")

        });

        myLayout.registerComponent('canvas', function(container, state) {
            container.getElement().html('<h2>' + state.title + '</h2>');
            container.on("resize", function(e) {
                console.log("resize canvas", e)
                container.getElement().html("resize c")
            })
            myLayout.eventHub.on("resize", function(d) {
                //console.log(myLayout.getComponent("canvas"))
                //console.log(myLayout.eventHub)
                console.log("ab?", d)
                container.getElement().html("resize a and b")
            })

            console.log(container.getElement())


        });


        myLayout.init();

    }(jQuery))
</script>

</html>
